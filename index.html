<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="resource/css/normalize.css">
    <script src="resource/js/jquery-2.2.0.js"></script>
    <script src="js/md5.js"></script>
    <script src="js/main.js"></script>
    <title>如约城际</title>
</head>

<body>
    <div class="main">
        <input id="imgInp" type="file" accept="image/*" capture="camera" multiple>

        <div style="width: 300px;height: 400px;border: 1px solid black;">
            <img id="blah" style="width: 300px;height: 400px; " src="" alt="">
        </div>
        <div>
            <button class="sub">按钮</button>
        </div>
    </div>
</body>

<script>
    var appkey = 'FwfG7x82k1wQXU02';
    var appID = '1106850849';
    var imgBase = '';
    var sign = '';
    var submitData = {
        'app_id':appID,
        'image':'',
        'model':3,
        'nonce_str':'20e3408a88',
        'sign':'',
        'time_stamp':new Date().getTime()/1000
    }

    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#blah').attr('src', e.target.result);
                imgBase =(""+e.target.result).split(',')[1];
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#imgInp").change(function () {
        readURL(this);
    });

    $('.sub').click(function(){
        submitData['image'] = imgBase;
        submitData['time_stamp'] = Math.floor(new Date().getTime()/1000);
        var str = '';
        for(var i in submitData){
            if(submitData[i]!= ''){
                str += (i+'='+encodeURIComponent(submitData[i])+'&')
            }   
        }
        str += ('app_key='+appkey);
        sign = md5(str).toUpperCase();
        submitData['sign'] = sign;
        console.log(submitData)
        $.ajax({  
            type:'post',  
            dataType :'json',                  
            contentType:'application/x-www-form-urlencoded; charset=utf-8',     
            url:"https://api.ai.qq.com/fcgi-bin/ptu/ptu_facemerge",  
            data:submitData,  
            success:function(data){  
              console.log(data)
            },  
            error:function(data){
                console.log(data)  
                alert("error:"+data);  
            }  
        });  

    })

    function changeSign(params, appkey) {

    }




</script>

</html>